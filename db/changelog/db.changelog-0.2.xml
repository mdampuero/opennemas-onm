<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9 http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">        
    
    <changeSet author="vifito" id="1271757474">
        <comment>Add column to pages</comment>                
        
        <addColumn tableName="pages">
            <column name="weight" type="int" defaultValueNumeric="0" />
        </addColumn>
        
    </changeSet>
    
    
    <changeSet author="vifito" id="1271765397">
        <comment>Initial users/groups</comment>                
        
        <insert tableName="user_groups">
            <column name="pk_user_group" valueNumeric="1"/>
            <column name="name" value="Administrador"/>
        </insert>
        
        <dropColumn tableName="users" columnName="online"/>
        
        <insert tableName="users">
            <column name="pk_user" valueNumeric="1"/>
            <column name="login" value="admin"/>
            <column name="password" value="b7592fd66feb65282791ab64685e4af4"/>
            <column name="email" value="admin@openhost.es"/>
            <column name="name" value="Administrador"/>            
            <column name="fk_user_group" valueNumeric="1"/>
        </insert>
        
        <insert tableName="users">
            <column name="pk_user" valueNumeric="2"/>
            <column name="login" value="macada"/>
            <column name="password" value="e9e423467af0d1742ef1cc2f3e240b56"/>
            <column name="email" value="macada@openhost.es"/>
            <column name="name" value="David"/>            
            <column name="fk_user_group" valueNumeric="1"/>
        </insert>
        
        <insert tableName="users">
            <column name="pk_user" valueNumeric="3"/>
            <column name="login" value="sandra"/>
            <column name="password" value="bd80e7c35b56dccd2d1796cf39cd05f6"/>
            <column name="email" value="sandra@openhost.es"/>
            <column name="name" value="Sandra"/>            
            <column name="fk_user_group" valueNumeric="1"/>
        </insert>
        
        <insert tableName="users">
            <column name="pk_user" valueNumeric="4"/>
            <column name="login" value="fran"/>
            <column name="password" value="6d87cd9493f11b830bbfdf628c2c4f08"/>
            <column name="email" value="fran.dieguez@openhost.es"/>
            <column name="name" value="Fran"/>            
            <column name="fk_user_group" valueNumeric="1"/>
        </insert>
        
        <insert tableName="users">
            <column name="pk_user" valueNumeric="5"/>
            <column name="login" value="vifito"/>
            <column name="password" value="243fc9136f3284371b4826b905417964"/>
            <column name="email" value="vifito@openhost.es"/>
            <column name="name" value="TomÃ¡s"/>            
            <column name="fk_user_group" valueNumeric="1"/>
        </insert>
        
    </changeSet>
    
    
    <changeSet author="vifito" id="1271781664">
        <dropColumn tableName="pages" columnName="visible"/>
        <addColumn tableName="pages">
            <column name="status" type="enum('PENDING','AVAILABLE','REMOVED')"/>
        </addColumn>
    </changeSet>
    
    
    <changeSet author="vifito" id="1271781863">
        <dropColumn tableName="pages" columnName="type"/>
        <addColumn tableName="pages">
            <column name="type" type="enum('STANDARD','EXTERNAL','SHORTCUT','NOT_IN_MENU')"/>
            <!-- TODO: add MOUNT_POINT to future version -->
        </addColumn>
    </changeSet>
    
    <changeSet author="vifito" id="1273837344">        
        <addColumn tableName="contents">
            <column name="version" type="int" defaultValueNumeric="0"/>
        </addColumn>
    </changeSet>
    
    <changeSet author="vifito" id="1274168334">
        <comment>Refactoring table categories</comment>
        
        <dropColumn tableName="categories" columnName="inmenu"/>        
        <dropColumn tableName="categories" columnName="internal_category"/>        
        <dropColumn tableName="categories" columnName="logo_path"/>
        <dropColumn tableName="categories" columnName="color"/>
        <dropColumn tableName="categories" columnName="posmenu"/>
        
        <dropColumn tableName="categories" columnName="fk_content_category"/>
        <addColumn tableName="categories">
            <column name="fk_category" type="int" defaultValueNumeric="0"/>
        </addColumn>
    </changeSet>
    
    <changeSet author="vifito" id="1274195863">
        <addAutoIncrement tableName="categories" columnName="pk_category" columnDataType="int"/>
    </changeSet>

    <changeSet author="vifito" id="1274347817">
        <comment>Change column name "metadata" field to "keywords"</comment>
        
        <renameColumn tableName="contents"
            oldColumnName="metadata" newColumnName="keywords" columnDataType="varchar(255)"/>
    </changeSet>
    
    <changeSet author="vifito" id="1274701070">
        <comment>Remove columns and home_columns. Use mask template now.</comment>
        
        <dropColumn tableName="articles" columnName="columns"/>        
        <dropColumn tableName="articles" columnName="home_columns"/>
    </changeSet>


    <changeSet author="vifito" id="1275044449">
        <comment>Create table keywords.</comment>
        
        <createTable tableName="keywords">
            <column name="pk_keyword" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="word" type="varchar(255)">
                <constraints unique="true" nullable="false" />
            </column>
            <column name="value" type="varchar(255)"/>
            <column name="type" type="enum('EMAIL','SEARCH','URL')"/>
        </createTable>
        
    </changeSet>
    
    <changeSet author="vifito" id="1275295673">
        <comment>New fields for "pages" table and rename "color" field to "inline_styles"</comment>
        
        <dropColumn tableName="pages" columnName="color"/>
        <addColumn tableName="pages">
            <column name="inline_styles" type="text"/>
        </addColumn>
        
        <addColumn tableName="pages">
            <column name="fk_author" remarks="User foreign key" type="int unsigned"/>
        </addColumn>
        
        <addColumn tableName="pages">
            <column name="fk_publisher" remarks="User foreign key" type="int unsigned"/>
        </addColumn>
        
        <addColumn tableName="pages">
            <column name="fk_user_last_editor" remarks="User foreign key" type="int unsigned"/>
        </addColumn>
        
        <addColumn tableName="pages">
            <column name="hits" remarks="Stats of visitors" type="int unsigned"/>
        </addColumn>
        
        <addColumn tableName="pages">
            <column name="starttime" type="DATETIME"/>
        </addColumn>
        
        <addColumn tableName="pages">
            <column name="endtime" type="DATETIME"/>
        </addColumn>
        
        <addColumn tableName="pages">
            <column name="created" type="DATETIME"/>
        </addColumn>
        
        <addColumn tableName="pages">
            <column name="changed" type="DATETIME"/>
        </addColumn>
        
        <addColumn tableName="pages">
            <column name="published" type="DATETIME"/>
        </addColumn>
        
        <addColumn tableName="pages">
            <column name="menu_title" type="varchar(255)"/>
        </addColumn>
        
        <addColumn tableName="pages">
            <column name="short_url" remarks="Use by short url services (bit.ly)" type="varchar(255)"/>
        </addColumn>
    </changeSet>
    
    <changeSet author="vifito" id="1275326820">
        <comment>Support to version on pages table</comment>
        <addColumn tableName="pages">
            <column name="version" type="int" defaultValueNumeric="0"/>
        </addColumn>
    </changeSet>
    
    <changeSet author="vifito" id="1275473187">
        <comment>Add support to fulltext searchs</comment>
        <sql>ALTER TABLE contents ADD FULLTEXT(title,description,keywords);</sql>
    </changeSet>
    
    <!-- Uncomment once this changeset is over -->
    <!-- changeSet author="vifito" id="">
        <tagDatabase tag="0.2"/>
    </changeSet -->
</databaseChangeLog>