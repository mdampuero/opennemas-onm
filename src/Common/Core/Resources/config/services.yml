parameters:
    core.locale.available: [ 'en_US', 'es_ES', 'gl_ES' ]
    core.locale.path:      '%kernel.root_dir%/Resources/locale'
    core.maintenance.file: '%kernel.root_dir%/../.maintenance'

services:
    core.instance:
        class:   Common\ORM\Entity\Instance
        factory: [ '@core.loader', 'getInstance' ]

    core.instance.checker:
        class:   Common\Core\Instance\Checker
        arguments: [ '@orm.manager' ]

    core.listener.core_loader:
        class: Common\Core\EventListener\CoreLoaderListener
        arguments: [ '@service_container' ]
        tags:
            - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest, priority: 99 }

    core.listener.locale:
        class:     Common\Core\EventListener\LocaleListener
        arguments: [ '@service_container' ]
        tags:
            - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest, priority: 0 }

    core.listener.maintenance:
        class:     Common\Core\EventListener\MaintenanceListener
        arguments: [ '%core.maintenance.file%' ]
        tags:
            - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest, priority: 100 }

    core.listener.security:
        class:     Common\Core\EventListener\SecurityListener
        arguments: [ '@service_container' ]
        tags:
            - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest, priority: 5 }

    core.listener.security.annotation:
        class:     Common\Core\EventListener\SecurityAnnotationListener
        arguments: [ '@annotation_reader', '@core.security' ]
        tags:
            - { name: kernel.event_listener, event: kernel.controller, method: onKernelController, priority: 0 }

    core.loader:
        class:     Common\Core\Loader\Loader
        arguments: [ '@service_container' ]

    core.locale:
        class:     Common\Core\Locale\Locale
        arguments: [ '%core.locale.available%', '%core.locale.path%' ]

    core.theme:
        class:     Common\ORM\Entity\Extension
        factory:   [ '@core.loader', 'getTheme' ]

    core.security:
        class:     Common\Core\Security\Security

    core.security.user:
        class:     Common\ORM\Entity\User
        factory:   [ '@core.security', 'getUser' ]

    core.user:
        alias:     'core.security.user'
