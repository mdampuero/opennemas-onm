'use strict';

/*
 jQuery UI Sortable plugin wrapper

 @param [ui-sortable] {object} Options to pass to $.fn.sortable() merged onto ui.config
 */
angular.module("ui.sortable",[]).value("uiSortableConfig",{}).directive("uiSortable",["uiSortableConfig","$timeout","$log",function(a,b,c){return{require:"?ngModel",link:function(d,e,f,g){function i(a,b){return b&&"function"==typeof b?function(c,d){a(c,d),b(c,d)}:a}var h,j={},k={receive:null,remove:null,start:null,stop:null,update:null};angular.extend(j,a),g?(d.$watch(f.ngModel+".length",function(){b(function(){e.sortable("refresh")})}),k.start=function(a,b){b.item.sortable={index:b.item.index(),cancel:function(){b.item.sortable._isCanceled=!0},isCanceled:function(){return b.item.sortable._isCanceled},_isCanceled:!1}},k.activate=function(){h=e.contents();var a=e.sortable("option","placeholder");if(a&&a.element&&"function"==typeof a.element){var b=a.element();b.jquery||(b=angular.element(b));var c=e.find('[class="'+b.attr("class")+'"]');h=h.not(c)}},k.update=function(a,b){b.item.sortable.received||(b.item.sortable.dropindex=b.item.index(),b.item.sortable.droptarget=b.item.parent(),e.sortable("cancel")),h.detach(),"clone"===e.sortable("option","helper")&&(h=h.not(h.last())),h.appendTo(e),b.item.sortable.received&&!b.item.sortable.isCanceled()&&d.$apply(function(){g.$modelValue.splice(b.item.sortable.dropindex,0,b.item.sortable.moved)})},k.stop=function(a,b){!b.item.sortable.received&&"dropindex"in b.item.sortable&&!b.item.sortable.isCanceled()?d.$apply(function(){g.$modelValue.splice(b.item.sortable.dropindex,0,g.$modelValue.splice(b.item.sortable.index,1)[0])}):"dropindex"in b.item.sortable&&!b.item.sortable.isCanceled()||"clone"===e.sortable("option","helper")||h.detach().appendTo(e)},k.receive=function(a,b){b.item.sortable.received=!0},k.remove=function(a,b){b.item.sortable.isCanceled()||d.$apply(function(){b.item.sortable.moved=g.$modelValue.splice(b.item.sortable.index,1)[0]})},d.$watch(f.uiSortable,function(a){angular.forEach(a,function(a,b){k[b]&&("stop"===b&&(a=i(a,function(){d.$apply()})),a=i(k[b],a)),e.sortable("option",b,a)})},!0),angular.forEach(k,function(a,b){j[b]=i(a,j[b])})):c.info("ui.sortable: ngModel not provided!",e),e.sortable(j)}}}]);
