services:
    context:
        class: Symfony\Component\Routing\RequestContext

    matcher:
        class: Symfony\Component\Routing\Matcher\UrlMatcher
        arguments: [ %routes%, @context ]

    resolver:
        class: Onm\Framework\ControllerResolver

    listener.router:
        class: Symfony\Component\HttpKernel\EventListener\RouterListener
        arguments: [ @matcher ]

    listener.response:
        class: Symfony\Component\HttpKernel\EventListener\ResponseListener
        arguments: [ %charset% ]

    listener.instanceloader:
        class: Framework\EventListeners\InstanceLoaderListener

    listener.admin_auth:
        class: Framework\EventListeners\AdminAuthenticationListener

    listener.controller:
        class: Framework\EventListeners\ControllerListener

    listener.session:
        class: Framework\EventListeners\SessionListener

    listener.instance_not_available:
        class: Framework\EventListeners\InstanceNotAvailableExceptionListener

    dispatcher:
        class: Symfony\Component\EventDispatcher\EventDispatcher
        calls:
            - ['addSubscriber', [ @listener.router]]
            - ['addSubscriber', [ @listener.admin_auth]]
            - ['addSubscriber', [ @listener.instanceloader]]
            - ['addSubscriber', [ @listener.controller]]
            - ['addSubscriber', [ @listener.response]]
            - ['addSubscriber', [ @listener.session]]
            - ['addSubscriber', [ @listener.instance_not_available]]

    framework:
        class: Onm\Framework\Framework
        arguments: [ @dispatcher, @resolver ]

    url_generator:
        class: Symfony\Component\Routing\Generator\UrlGenerator
        arguments: [ %routes%, @context ]

    db_conn:
        class: Onm\DatabaseConnection
        arguments: [ %database% ]

    db_conn_manager:
        class: Onm\DatabaseConnection
        arguments: [  %database% ]

    session_storage:
        class: %session_storage_class%
        arguments: [ %session_params% ]

    session:
        class: %session_handler_class%
        arguments: [ @session_storage ]

    logger:
        class: Onm\Log
        arguments: [ 'normal' ]

    mailer:
        class: Onm\Mailer
        arguments: [ %swiftmailer% ]

    cache:
        class: %cache_handler%
        arguments: [ %cache_handler_params% ]

    category_repository:
        class: Repository\CategoryManager
        arguments: [ @cache, %cache_prefix% ]

    comment_repository:
        class: Repository\CommentManager
        arguments: [ @cache, %cache_prefix% ]

    entity_repository:
        class: Repository\EntityManager
        arguments: [ @cache, %cache_prefix% ]

    user_repository:
        class: Repository\UserManager
        arguments: [ @cache, %cache_prefix% ]

    menu_repository:
        class: Repository\MenuManager
        arguments: [ @cache, %cache_prefix% ]

    usergroup_repository:
        class: Repository\UserGroupManager
        arguments: [ @cache, %cache_prefix% ]

    setting_repository:
        class: Repository\SettingManager
        arguments: [ @cache, %cache_prefix% ]

    newsletter_manager:
        class: Repository\NewsletterManager
        arguments: [ @mailer, @logger ]

    automatic_contents:
        class: Onm\MachineSearcher
        arguments: [ @cache ]
